function setBoardSize(){var a=document.getElementById("0,0");fontHeight=a.offsetHeight,fontWidth=a.offsetWidth;var b=document.getElementById("gameText"),c=parseFloat(window.getComputedStyle(b).padding);boardHeight=Math.floor((b.offsetHeight-2*c)/fontHeight),boardWidth=Math.floor((b.clientWidth-10*c)/fontWidth),resetBoard()}function resetBoard(){gameLoop||(gameBoard=genRandomBoard(boardHeight,boardWidth),document.getElementById("gameText").innerHTML=boardToHTML(gameBoard))}function resetScore(){confirm("Are you sure you want to reset your high score?")&&(highScore=0,document.getElementById("highScoreText").textContent=highScore,setScoreCookie())}function updateSettings(a){speed=a.querySelector('select[name="speed"]').value,"cust"==(changeColor=a.querySelector('input[name="changeColor"]:checked').value)&&(changeColor=a.querySelector('input[name="customColor"]').value)}function boardToHTML(a){for(var b=boardHeight,c=boardWidth,d="",e=0;e<b;e++){for(var f=0;f<c;f++)d+="<span id='"+e+","+f+"' onclick='charClicked("+e+","+f+")'>",d+=cornerText[a[e][f]],d+="</span>";d+="<br>"}return d}function genRandomBoard(a,b){for(var c=[],d=0;d<a;d++){for(var e=[],f=0;f<b;f++)e.push(4*Math.random()|0);c.push(e)}return c}function charClicked(a,b){0==neighbors.length&&(neighbors=[[a,b]],gameLoop=setInterval(chainReact,10*speed))}function changeCell(a,b){gameBoard[a][b]=(gameBoard[a][b]+1)%4,document.getElementById(a+","+b).innerHTML=cornerText[gameBoard[a][b]],"rand"==changeColor?document.getElementById(a+","+b).style.color="#"+((1<<24)*Math.random()|0).toString(16):"none"!=changeColor&&(document.getElementById(a+","+b).style.color=changeColor),score++}function chainReact(){if(neighbors.length>0){for(var a=0,b=neighbors.length;a<b;a++)changeCell(neighbors[a][0],neighbors[a][1]);neighbors=getNeighbors(neighbors,gameBoard),document.getElementById("scoreText").textContent=score}else clearInterval(gameLoop),gameLoop=!1,score>highScore&&(highScore=score,document.getElementById("highScoreText").textContent=highScore,setScoreCookie()),score=0}function getNeighbors(a,b){for(var c=[],d=b.length,e=b[0].length,f=0,g=a.length;f<g;f++){var h=a[f][0],i=a[f][1];h-1>=0&&b[h][i]%3==0&&b[h-1][i]%3!=0&&c.push([h-1,i]),i-1>=0&&b[h][i]>=2&&b[h][i-1]<=1&&c.push([h,i-1]),h+1<d&&b[h][i]%3!=0&&b[h+1][i]%3==0&&c.push([h+1,i]),i+1<e&&b[h][i]<=1&&b[h][i+1]>=2&&c.push([h,i+1])}return removeDuplicates(c)}function removeDuplicates(a){for(var b=a.length,c=[],d=[],e=0;e<b;e++)d.push(JSON.stringify(a[e]));for(var e=0;e<b;e++){for(var f=!0,g=e+1;g<b&&f;g++)d[e]==d[g]&&(f=!1);f&&c.push(a[e])}return c}function setScoreCookie(){document.cookie="highScore="+highScore+"; expires=Tue, 19 Jan 2038 03:14:07 UTC"}function getScoreCookie(){for(var a="highScore=",b=decodeURIComponent(document.cookie),c=b.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(a))return parseInt(e.substring(a.length,e.length))}return 0}var DEBUG_MODE=!1,cornerText=["&boxur;","&boxdr;","&boxdl;","&boxul;"],boardHeight=45,boardWidth=140,gameBoard,neighbors=[],gameLoop=!1,changeColor="#990000",highScore=0,score=0,speed=8;window.onload=function(){highScore=getScoreCookie(),setBoardSize(),document.getElementById("highScoreText").textContent=highScore};
